<?php  
/* 
Plugin Name: ATM Cookies Disclaimer
Plugin URI: http://www.atmospherecommunication.fr/ 
Description: ATM Cookies Disclaimer est un plugin qui permet d'afficher un bandeau informant l'utilisateur sur l'utilisation de "cookies" et de "traceurs" sur le site
Version: 1.2.0 
Author: Antoine Brunet
Author URI: http://www.atmospherecommunication.fr 
*/  

/**
 * Initialisation de la session
 */
session_start();


define("ATM_COOKIES_LAIUS_CONTENT_FR","<h2>Qu'est-ce qu'un cookie ?</h2><p>Un cookie est un petit fichier texte au format alphanumérique déposé sur le disque dur de l'internaute par le serveur du site visité ou par un serveur tiers (régie publicitaire, service de web analytique, etc..). Un cookie permet de reconnaître un visiteur lorsqu'il revient sur un site web. Cependant, sur un plan technique, le cookie permet en fait de reconnaître une machine et non réellement un utilisateur. C'est grâce aux cookies qu'il est possible d'accéder automatiquement à des pages personnalisées sans s'identifier. Les données comportementales sont liées au numéro de cookie et stockées au niveau des serveurs ayant placé les cookies. Un cookie ne permet une identification nominative que si l'internaute s'est déjà enregistré sur le site (dans la limite évoquée précédemment).</p><h2>Les cookies utilisés</h2><p>Lors de la consultation de notre site, des informations relatives à la navigation de votre terminal (ordinateur, tablette, smartphone, etc.) sur notre site sont susceptibles d'être enregistrées dans des fichiers \"Cookies\" installés sur votre terminal. Par ailleurs, nous sommes susceptibles d'acheter des espaces publicitaires directement ou par l'intermédiaire de nos prestataires (agences de communication, régies publicitaire) afin de promouvoir nos activités et nos offres sur des sites de tiers, au moyen de contenus publicitaires (textes, graphismes, animations, vidéos, etc.) diffusés par ces sites. Sachez que seul l'émetteur d'un cookie est susceptible de lire ou de modifier des informations qui y sont contenues.</p><h3>1. Les cookies que nous émettons sur notre site</h3><p>Lorsque vous vous connectez à notre site, nous pouvons être amenés à installer divers cookies dans votre terminal nous permettant de reconnaître le navigateur de votre terminal pendant la durée de validité du cookie concerné.</p><p>Ces cookies nous permettent :</p><ul><li>d'établir des statistiques et volumes de fréquentation et d'utilisation des diverses éléments composant notre site (rubriques et contenus visités, parcours), nous permettant d'améliorer l'intérêt et l'ergonomie de nos services ;</li><li>d'adapter la présentation de notre site aux préférences d'affichage de votre terminal (langue utilisée, résolution d'affichage, système d'exploitation utilisé, etc.) lors de vos visites sur notre site, selon les matériels et les logiciels de visualisation ou de lecture que votre terminal comporte;</li><li>de mémoriser des informations relatives à un formulaire que vous avez rempli sur notre site (inscription ou accès à votre compte) ou à des produits, services ou informations que vous avez choisis sur notre site (contenu d'un panier de commande, etc.) ;</li><li>de vous permettre d'accéder à des espaces réservés et personnels de notre site, tels que votre compte, grâce à des identifiants ou des données que vous nous avez éventuellement confiés antérieurement ;</li><li>de mettre en œuvre des mesures de sécurité, par exemple lorsqu'il vous est demandé de vous connecter à nouveau à un contenu ou à un service après un certain laps de temps.</li></ul><h3>2. Les cookies tiers</h3><p>Des cookies sont également susceptibles d'être placés par des sociétés partenaires (cookies tiers). Ces cookies ont notamment pour finalité d'identifier vos centres d'intérêt au travers des produits consultés ou achetés sur notre site et de collecter des données de navigation afin de personnaliser l'offre publicitaire qui vous est adressée en dehors du site ou de répondre à des objectifs déterminés.</p><p>Des cookies peuvent également être enregistrés via notre  site sur votre terminal par les réseaux sociaux  lorsque vous utilisez des boutons réseaux (« Facebook », « Pinterest », «Instagram », « Google + » etc.…).</p><h3>3. Les cookies posés par nous sur des sites sur lesquels nos publicités sont présentes</h3><p>Lorsque vous accédez à un site contenant une de nos publicités, cette annonce peut contenir un cookie. Ce cookie est susceptible d'être enregistré dans votre terminal et de nous permettre de reconnaître le navigateur de votre terminal pendant la durée de validité du cookie concerné.</p><h3>4. Les cookies \"FLASH\"© DE \"ADOBE FLASH PLAYER\"™</h3><p>\"Adobe Flash Player\"™ est une application informatique qui permet le développement rapide des contenus dynamiques utilisant le langage informatique \"Flash\". Flash (et les applications de même type) mémorise les paramètres, les préférences et l'utilisation de ces contenus grâce à une technologie similaire aux cookies. Toutefois, \"Adobe Flash Player\"™ gère ces informations et vos choix via une interface différente de celle fournie par votre logiciel de navigation.</p><p>Dans la mesure où votre terminal serait susceptible de visualiser des contenus développés avec le langage Flash, nous vous invitons à accéder à vos outils de gestion des cookies Flash, directement depuis le site web d'Adobe : <a href=\"http://www.adobe.com/fr/\" title=\"http://www.adobe.com/fr/\">http://www.adobe.com/fr/</a>.</p><h2>Comment gérer vos cookies ?</h2><p>Plusieurs possibilités vous sont offertes pour gérer vos cookies. Tout paramétrage que vous pouvez entreprendre sera susceptible de modifier votre navigation sur internet et vos conditions d'accès à certains services nécessitant l'utilisation de cookies.</p><p>Vous pouvez faire le choix à tout moment d'exprimer et de modifier vos souhaits en matière de cookies, par les moyens décrits ci-dessous.</p><h2>Les choix qui vous sont offerts par votre logiciel de navigation</h2><p>Vous pouvez configurer votre logiciel de navigation de manière à ce que des cookies soient enregistrés dans votre terminal ou, au contraire, qu'ils soient rejetés, soit systématiquement, soit selon leur émetteur. Vous pouvez également configurer votre logiciel de navigation de manière à ce que l'acceptation ou le refus des cookies vous soient proposés ponctuellement, avant qu'un cookie soit susceptible d'être enregistré dans votre terminal.</p><p>Si vous avez accepté dans votre logiciel de navigation l'enregistrement de cookies dans votre terminal, les cookies intégrés dans les pages et contenus que vous avez consultés pourront être stockés temporairement dans un espace dédié de votre terminal. Ils y seront lisibles uniquement par leur émetteur.</p><p>Si vous refusez l'enregistrement dans votre terminal des cookies que nous émettons, ou si vous supprimez ceux que nous y avons enregistrés, vous ne pourrez plus bénéficier d'un certain nombre de fonctionnalités qui sont néanmoins nécessaires pour naviguer dans certains espaces de notre site. Tel serait le cas lorsque nous ne pourrions pas reconnaître, à des fins de compatibilité technique, le type de navigateur utilisé par votre terminal, ses paramètres de langue et d'affichage ou le pays depuis lequel votre terminal semble connecté à internet. Le cas échéant, nous déclinons toute responsabilité pour les conséquences liées au fonctionnement dégradé de nos services résultant de l'impossibilité pour nous d'enregistrer ou de consulter les cookies nécessaires à leur fonctionnement et que vous auriez refusés ou supprimés.</p><p>Pour la gestion des cookies et de vos choix, la configuration de chaque navigateur est différente. Elle est décrite dans le menu d'aide de votre navigateur, qui vous permettra de savoir de quelle manière modifier vos souhaits en matière de cookies.</p><ul><li>Avec le navigateur Internet Explorer : Ouvrir le menu \"Outils\", sélectionner la rubrique \"Options Internet\", cliquer sur l'onglet \"Sécurité\", puis \"Personnaliser le niveau\".</li><li>Avec le navigateur Mozilla : Ouvrir le menu \"Outils\", sélectionner la rubrique \"Options\", cliquer sur l'onglet \"Vie privée\".</li><li>Avec le navigateur Chrome : Ouvrir le menu \"Outils\", sélectionner la rubrique \"Options\", cliquer sur l'onglet \"Options avancées\", puis cliquer sur le bouton \"Paramètres de contenu\", cliquer sur l'onglet \"Cookies\".</li><li>Avec le navigateur Safari : Ouvrir le menu \"Outils\", sélectionner la rubrique \"Préférences\", cliquer sur l'onglet \"Sécurité\".</li><li>Avec le navigateur Opera : Ouvrir le menu \"Outils\", sélectionner la rubrique \"Préférences\", cliquer sur l'onglet \"Cookies\".</li></ul><h2>Vos choix exprimés en ligne auprès de plateformes interprofessionnelles</h2><p>Vous pouvez vous connecter au site Youronlinechoices, proposé par les professionnels de la publicité digitale regroupés au sein de l'association européenne EDAA (European Digital Advertising Alliance) et géré en France par l'Interactive Advertising Bureau France.</p><p>Vous pourrez ainsi connaître les entreprises inscrites à cette plate-forme et qui vous offrent la possibilité de refuser ou d'accepter les cookies utilisés par ces entreprises pour adapter à vos informations de navigation les publicités susceptibles d'être affichées sur votre terminal : <a href=\"http://www.youronlinechoices.com/fr/controler-ses-cookies/\" title=\"http://www.youronlinechoices.com/fr/controler-ses-cookies/\">http://www.youronlinechoices.com/fr/controler-ses-cookies/</a>.</p><p>Cette plate-forme européenne est partagée par des centaines de professionnels de la publicité sur internet et constitue une interface centralisée vous permettant d'exprimer votre refus ou votre acceptation des cookies susceptibles d'être utilisés afin d'adapter à la navigation de votre terminal les publicités susceptibles d'y être affichées.</p><p>Notez que cette procédure n'empêchera pas l'affichage de publicités sur les sites Internet que vous visitez. Elle ne bloquera que les technologies qui permettent d'adapter des publicités à vos centres d'intérêts.</p>");

/* VERIFICATION QU'UN AUTRE PLUGIN AVEC LE MEME NOM N'EXISTE PAS */
// Si la classe n'existe pas, on la créé
if (!class_exists("atm_cookies_disclaimer"))
{
    class atm_cookies_disclaimer {

        var $version = '1.2.0';

        /**
         * Constructeur
         */
        function atm_cookies_disclaimer()
        {
            
        }
        /**
         * Chargement des fichiers Javascript pour le front-office
         */
        function add_custom_front_scripts( $hook ) {
            if(!isset($_SESSION['atm_cookies_disclaimer_closed']) || empty($_SESSION['atm_cookies_disclaimer_closed']) || !$_SESSION['atm_cookies_disclaimer_closed']){
                wp_enqueue_script(  'atm_cookies_disclaimer_custom_js', plugins_url( 'js/atm_cookies_disclaimer.js' , __FILE__ ), array(), '1.2.0', true);
            }
        }
        /**
         * Chargement des fichiers Javascript pour le back-office
         */
        function add_custom_back_scripts( $hook ) {
           if (is_admin() && $_GET['page'] == "atm-cookies-disclaimer") {
                wp_enqueue_script('atm-cd-jquery-ui-tabs', 'https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js', array('jquery'), '1.11.4', true);
            }
        }     
         /**
         * Chargement des fichiers CSS pour le back-office
         */
        function add_custom_back_styles( $hook ) {
            global $wp_scripts;
            if (is_admin() && $_GET['page'] == "atm-cookies-disclaimer") {
                wp_enqueue_style("atm-cd-jquery-ui-css", "//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css");
                //wp_enqueue_style("atm-cd-jquery-ui-structure-css", "https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.structure.min.css");
                //wp_enqueue_style("atm-cd-jquery-ui-theme-css", "https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.theme.min.css");
            }
        }        
        /**
         * Fonction de nettoyage des variables (string, integer, float et array)
         *
         * @param string $input
         *
         * @return string
         *
         */
        function atm_cd_sanitize($input) {
          if (is_array($input)) {
                foreach($input as $var=>$val) {
                    $output[$var] = $this->atm_cd_sanitize($val);
                }
            }
            else {
            $search = array(
            '@<script[^>]*?>.*?</script>@si',   // Strip out javascript
            '@<style[^>]*?>.*?</style>@siU',    // Strip style tags properly
            '@<![\s\S]*?--[ \t\n\r]*>@'         // Strip multi-line comments
            );
           
            $output = preg_replace($search, '', $input);
            $output = strip_tags($output, '<br>');
            $output = trim($output);
          }
            return $output;
        }

        function ajax_atm_cookies_disclaimer_close()
        {
            $_SESSION['atm_cookies_disclaimer_closed'] = true;
            $arr['success'] = true;
            echo json_encode($arr);
            exit;
        }
        /**
         * Affichage du menu d'administration : Galeries photos
         * @global wpdb $wpdb
         */
        function printAdminCookiesMenu()
        {
            global $wpdb;
            if(!is_admin()) die();
            include('php/admin_cookies_menu.php');
        }
        /*
         * Ajout des menu dans l'administration de WordPress
         *
         */
        function register_custom_menu_page() {
            add_submenu_page( 'tools.php',  __('Bandeau pour les cookies'), __('Bandeau pour les cookies'), 'edit_themes', 'atm-cookies-disclaimer', array(&$this, 'printAdminCookiesMenu'));
        }
        /**
         * Shortcode qui affiche le bandeau
         *
         * @global wpdb $wpdb
         */
        function shortcode_atm_cookies_disclaimer($attributes)
        {
            global $wpdb, $polylang;
            if(!isset($_SESSION['atm_cookies_disclaimer_closed']) || empty($_SESSION['atm_cookies_disclaimer_closed']) || !$_SESSION['atm_cookies_disclaimer_closed']){
                if(isset($polylang) && !empty($polylang) && !is_null($polylang)){
                    $suffix_lang = pll_current_language('locale');
                    $current_language = pll_current_language('slug');
                    $page_id = intval($wpdb->get_var("SELECT ID FROM $wpdb->posts WHERE post_name = 'protection-de-la-vie-privee'"));
                    $pll_post_id = pll_get_post($page_id, $current_language);if($pll_post_id){$permalink = get_permalink($pll_post_id);}else{$permalink = home_url('/protection-de-la-vie-privee/');}
                }else{
                    $suffix_lang = 'fr_FR';
                    $permalink = home_url('/protection-de-la-vie-privee/');
                }

                echo '<div class="atm-cookies-disclaimer" style="display:block;position:'.get_option('atm_cookies_disclaimer_bandeau_position_'.$suffix_lang).';box-sizing: border-box;z-index:999999;width:100%;padding:0.5% 1%;font-size:90%;text-align:center;color:'.get_option('atm_cookies_disclaimer_bandeau_texte_couleur_'.$suffix_lang).';background:rgba('.get_option('atm_cookies_disclaimer_bandeau_fond_couleur_'.$suffix_lang).','.get_option('atm_cookies_disclaimer_bandeau_fond_transparence_'.$suffix_lang).');"><span>'.stripslashes(get_option('atm_cookies_disclaimer_bandeau_texte_'.$suffix_lang)).'<button style="display:inline-block;position:relative;vertical-align:middle;*display:inline;*zoom:1;margin:0 1em;border:'.get_option('atm_cookies_disclaimer_bouton_bordure_couleur_'.$suffix_lang).';background-color:'.get_option('atm_cookies_disclaimer_bouton_fond_couleur_'.$suffix_lang).';color:'.get_option('atm_cookies_disclaimer_bouton_texte_couleur_'.$suffix_lang).';padding:0.5em;">'.stripslashes(get_option('atm_cookies_disclaimer_bandeau_bouton_texte_'.$suffix_lang)).'</button><a style="color:'.get_option('atm_cookies_disclaimer_bandeau_texte_couleur_'.$suffix_lang).'" href="'.$permalink.'" title="'.stripslashes(get_option('atm_cookies_disclaimer_bandeau_lien_texte_'.$suffix_lang)).'">'.stripslashes(get_option('atm_cookies_disclaimer_bandeau_lien_texte_'.$suffix_lang)).'</a></span></div>';
            }
        }
        /**
         * Installation du plugin atm_cookies_disclaimer
         * @global wpdb $wpdb
         */
        function atm_cookies_disclaimer_install()
        {
            global $wpdb, $polylang;
            unset($_SESSION['atm_cookies_disclaimer_closed']);

            $option['atm_cookies_disclaimer_version'] = $this->version;
            update_option('atm_cookies_disclaimer_version',$option);
            if(isset($polylang) && !empty($polylang) && !is_null($polylang)){$availableLang = $polylang->model->get_languages_list();
                foreach ($availableLang as $lang){
                    update_option('atm_cookies_disclaimer_bandeau_texte_'.$lang->locale,'Ce site utilise des cookies pour réaliser des statistiques, personnaliser votre visite et vous assurer une meilleure expérience de navigation. En continuant votre visite, vous acceptez l\'utilisation des cookies.');
                    update_option('atm_cookies_disclaimer_bandeau_bouton_texte_'.$lang->locale,'OK');
                    update_option('atm_cookies_disclaimer_bandeau_lien_texte_'.$lang->locale,'En savoir plus');
                    update_option('atm_cookies_disclaimer_bandeau_position_'.$lang->locale,'relative');
                    update_option('atm_cookies_disclaimer_bandeau_fond_couleur_'.$lang->locale,'0,0,0');
                    update_option('atm_cookies_disclaimer_bandeau_fond_transparence_'.$lang->locale,'0.8');
                    update_option('atm_cookies_disclaimer_bandeau_texte_couleur_'.$lang->locale,'#FFFFFF');
                    update_option('atm_cookies_disclaimer_bouton_fond_couleur_'.$lang->locale,'transparent');
                    update_option('atm_cookies_disclaimer_bouton_texte_couleur_'.$lang->locale,'#FFFFFF');
                    update_option('atm_cookies_disclaimer_bouton_bordure_couleur_'.$lang->locale,'1px solid #FFFFFF');
                }
            }else{
                update_option('atm_cookies_disclaimer_bandeau_texte_fr_FR','Ce site utilise des cookies pour réaliser des statistiques, personnaliser votre visite et vous assurer une meilleure expérience de navigation. En continuant votre visite, vous acceptez l\'utilisation des cookies.');
                update_option('atm_cookies_disclaimer_bandeau_bouton_texte_fr_FR','OK');
                update_option('atm_cookies_disclaimer_bandeau_lien_texte_fr_FR','En savoir plus');
                update_option('atm_cookies_disclaimer_bandeau_position_fr_FR','relative');
                update_option('atm_cookies_disclaimer_bandeau_fond_couleur_fr_FR','0,0,0');
                update_option('atm_cookies_disclaimer_bandeau_fond_transparence_fr_FR','0.8');
                update_option('atm_cookies_disclaimer_bandeau_texte_couleur_fr_FR','#FFFFFF');
                update_option('atm_cookies_disclaimer_bouton_fond_couleur_fr_FR','transparent');
                update_option('atm_cookies_disclaimer_bouton_texte_couleu_fr_FRr','#FFFFFF');
                update_option('atm_cookies_disclaimer_bouton_bordure_couleur_fr_FR','1px solid #FFFFFF');
            }

            // on créé une page galerie photo
            $table_name = $wpdb->prefix.'posts';
            $query = $wpdb->prepare("SELECT id FROM $table_name WHERE post_name = '%s' AND post_title= '%s'", 'protection-de-la-vie-privee', 'Protection de la vie privée');
            $results = $wpdb->get_results($query);
            if (sizeof($results) === 0) {
                $date = date('Y-m-d H:i:s');
                $gmtDate = gmdate('Y-m-d H:i:s');
                $guid = get_option('siteurl').'/protection-de-la-vie-privee/';
                $wpdb->insert($table_name, array(
                            'post_author'       => 1,
                            'post_date'         => $date,
                            'post_date_gmt'     => $gmtDate,
                            'post_content'      => ATM_COOKIES_LAIUS_CONTENT_FR,
                            'post_title'        => 'Protection de la vie privée',
                            'post_status'       => 'publish',
                            'post_name'         => 'protection-de-la-vie-privee',
                            'post_modified'     => $date,
                            'post_modified_gmt' => $gmtDate,
                            'post_parent'       => 0,
                            'guid'              => $guid,
                            'post_type'         => 'page'
                        ), 
                        array( 
                            '%d',
                            '%s',
                            '%s',
                            '%s',
                            '%s',
                            '%s',
                            '%s',
                            '%s',
                            '%s',
                            '%d',
                            '%s',
                            '%s'
                         ));
            }else{echo 'Erreur - Impossible de créer la page "Protection de la vie privée".';}
        }
        /**
         * Désinstallation du plugin atm_cookies_disclaimer
         * @global wpdb $wpdb
         */
        function atm_cookies_disclaimer_uninstall()
        {
            if (!defined('WP_UNINSTALL_PLUGIN'))
            exit();
            global $wpdb, $polylang;
            require_once(ABSPATH . 'wp-admin/includes/upgrade.php');

            delete_option('atm_cookies_disclaimer_version');
            if(isset($polylang) && !empty($polylang) && !is_null($polylang)){$availableLang = $polylang->model->get_languages_list();
                foreach ($availableLang as $lang){
                    delete_option('atm_cookies_disclaimer_bandeau_texte_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bandeau_bouton_texte_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bandeau_lien_texte_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bandeau_position_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bandeau_fond_couleur_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bandeau_fond_transparence_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bandeau_texte_couleur_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bouton_fond_couleur_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bouton_texte_couleur_'.$lang->locale);
                    delete_option('atm_cookies_disclaimer_bouton_bordure_couleur_'.$lang->locale);
                }
            }else{
                delete_option('atm_cookies_disclaimer_bandeau_texte_fr_FR');
                delete_option('atm_cookies_disclaimer_bandeau_bouton_texte_fr_FR');
                delete_option('atm_cookies_disclaimer_bandeau_lien_texte_fr_FR');
                delete_option('atm_cookies_disclaimer_bandeau_position_fr_FR');
                delete_option('atm_cookies_disclaimer_bandeau_fond_couleur_fr_FR');
                delete_option('atm_cookies_disclaimer_bandeau_fond_transparence_fr_FR');
                delete_option('atm_cookies_disclaimer_bandeau_texte_couleur_fr_FR');
                delete_option('atm_cookies_disclaimer_bouton_fond_couleur_fr_FR');
                delete_option('atm_cookies_disclaimer_bouton_texte_couleur_fr_FR');
                delete_option('atm_cookies_disclaimer_bouton_bordure_couleur_fr_FR');
            }
            
            $table_name_posts = $wpdb->prefix.'posts';
            
            $queryFinds = $wpdb->prepare("SELECT ID FROM $table_name_posts WHERE post_name = '%s' AND post_title= '%s'", 'protection-de-la-vie-privee', 'Protection de la vie privée');
            $finds = $wpdb->get_results($queryFinds);
            if (sizeof($finds) > 0) {
                // Suppression de la page Galeries photos
                $queryImages = $wpdb->prepare("DELETE FROM $table_name_posts WHERE post_name = '%s' AND post_title= '%s'", 'protection-de-la-vie-privee', 'Protection de la vie privée');
                $wpdb->query($queryPage);
            }
        }
        /**
         * Désactivation du plugin atm_cookies_disclaimer
         * @global wpdb $wpdb
         */
        function atm_cookies_disclaimer_deactivate()
        {
            $_SESSION['atm_cookies_disclaimer_closed'] = true;
        }
    }   
}
if (class_exists("atm_cookies_disclaimer"))
{
    $inst_atm_cookies_disclaimer = new atm_cookies_disclaimer();

    if (isset($inst_atm_cookies_disclaimer))
    {
        if(function_exists('register_activation_hook'))
            register_activation_hook(__FILE__, array(&$inst_atm_cookies_disclaimer, 'atm_cookies_disclaimer_install'));
        if(function_exists('register_deactivation_hook'))
            register_deactivation_hook(__FILE__, array(&$inst_atm_cookies_disclaimer, 'atm_cookies_disclaimer_deactivate'));
        if(function_exists('register_uninstall_hook'))
            register_uninstall_hook(__FILE__, array(&$inst_atm_cookies_disclaimer, 'atm_cookies_disclaimer_uninstall'));
        if(function_exists('add_action'))
        {
            add_action('admin_menu', array(&$inst_atm_cookies_disclaimer, 'register_custom_menu_page'));
            add_action('wp_enqueue_scripts', array(&$inst_atm_cookies_disclaimer, 'add_custom_front_scripts'));
            add_action('admin_print_scripts', array(&$inst_atm_cookies_disclaimer, 'add_custom_back_scripts'));
            add_action('admin_print_styles', array(&$inst_atm_cookies_disclaimer, 'add_custom_back_styles'));
        }
        if(function_exists('add_shortcode'))
        {
            add_shortcode('atmcookies',array(&$inst_atm_cookies_disclaimer, 'shortcode_atm_cookies_disclaimer'));
        }
    }
    if(isset($_POST['atm_action']))
    {
        switch($_POST['atm_action'])
        {
            case 'atm_cookies_disclaimer_close':
                    $inst_atm_cookies_disclaimer->ajax_atm_cookies_disclaimer_close();
                break;
            default:
                break;
        }
    }
}
?>